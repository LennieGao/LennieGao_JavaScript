var reg1,reg2,spans,phoneNumber=document.getElementById("phoneNum"),psd=document.getElementById("psd"),repsd=document.getElementById("repsd"),isTrue=[0,0,0];function init(){reg1=/^1[0-9]{10}$/,reg2=/^[\w]{8,18}$/,spans=document.querySelectorAll(".spans"),phoneNumber.addEventListener("blur",isNum),psd.addEventListener("blur",isNum),repsd.addEventListener("blur",isNum),send.addEventListener("click",Ajax)}function isNum(e){"phoneNum"===this.id?this.value.match(reg1)?(isTrue[0]=1,spans[0].style.display="none"):(isTrue[0]=0,spans[0].style.display="inline"):"psd"===this.id?this.value.match(reg2)?(isTrue[1]=1,spans[1].style.display="none"):(isTrue[1]=0,spans[1].style.display="inline"):"repsd"===this.id&&(this.value===psd.value?(isTrue[2]=1,spans[2].style.display="none"):(isTrue[2]=0,spans[2].style.display="inline"))}function Ajax(){if(isTrue[0]*isTrue[1]*isTrue[2]!=0){var e={hasUser:!1};e.phoneNumber=phoneNumber.value,e.psd=psd.value;var n=new XMLHttpRequest;n.addEventListener("load",loadHandler),n.open("POST","http://localhost:1024"),n.send(JSON.stringify(e))}else alert("您输入的有误")}function loadHandler(e){JSON.parse(this.response).hasUser?(alert("手机已被注册"),location.href="regist.html"):(alert("注册成功"),location.href="login.html")}init();var obj={};function logined(e){var n=new XMLHttpRequest;n.addEventListener("load",userLogin),n.open("POST","http://localhost:1026"),n.send(JSON.stringify(e))}function userLogin(e){var n=JSON.parse(this.response);n.isLogin?(loginTo.textContent=n.userObj,loginTo.href="",regTo.textContent="退出",regTo.href="",regTo.addEventListener("click",exitLogin)):(loginTo.textContent="登录",loginTo.href="html/login.html",regTo.removeEventListener("click",exitLogin),regTo.textContent="注册",regTo.href="html/regist.html"),console.log(n)}function exitLogin(e){obj.exit=!0;var n=new XMLHttpRequest;n.addEventListener("load",userLogin),n.open("POST","http://localhost:1026"),n.send(JSON.stringify(obj))}logined(obj);