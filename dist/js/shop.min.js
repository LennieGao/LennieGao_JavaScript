var obj={};function logined(e){var t=new XMLHttpRequest;t.addEventListener("load",userLogin),t.open("POST","http://localhost:1026"),t.send(JSON.stringify(e))}function userLogin(e){var t=JSON.parse(this.response);t.isLogin?(loginTo.textContent=t.userObj,loginTo.href="",regTo.textContent="退出",regTo.href="",regTo.addEventListener("click",exitLogin)):(loginTo.textContent="登录",loginTo.href="login.html",regTo.removeEventListener("click",exitLogin),regTo.textContent="注册",regTo.href="regist.html")}function exitLogin(e){obj.exit=!0;var t=new XMLHttpRequest;t.addEventListener("load",userLogin),t.open("POST","http://localhost:1026"),t.send(JSON.stringify(obj))}logined(obj);var arr,xhr=new XMLHttpRequest,areaContent={area:""};function loadHandler(e){arr=JSON.parse(this.response),areaBox.addEventListener("mouseenter",findP),place.addEventListener("mouseleave",clearAll),loadArea(areaContent)}function findP(e){place.style.display="block";for(var t=place.children.length,n=0;n<t;n++)place.firstElementChild.remove();for(var a=0;a<arr.length;a++){var r=document.createElement("div");r.textContent=arr[a].name,r.data=arr[a],r.addEventListener("click",findCity),place.appendChild(r)}}function findCity(e){for(var t=place.children.length,n=0;n<t;n++)place.firstElementChild.remove();for(var a=this.data.city,r=0;r<a.length;r++){var o=document.createElement("div");o.textContent=a[r].name,o.data=a[r],o.father=this,o.addEventListener("click",findArea),place.appendChild(o)}}function findArea(e){for(var t=place.children.length,n=0;n<t;n++)place.firstElementChild.remove();for(var a=this.data.area,r=0;r<a.length;r++){var o=document.createElement("div");o.textContent=a[r],o.father=this,o.addEventListener("click",addAddress),place.appendChild(o)}}function addAddress(e){areaContent.area=this.father.father.textContent+","+this.father.textContent+","+this.textContent,loadArea(areaContent);for(var t=place.children.length,n=0;n<t;n++)place.firstElementChild.remove()}function clearAll(e){place.style.display="none"}function loadArea(e){var t=new XMLHttpRequest;t.addEventListener("load",startArea),t.open("POST","http://localhost:1027"),t.send(JSON.stringify(e))}function startArea(e){areaBox.textContent=this.response}function getData(){var e=new XMLHttpRequest;e.addEventListener("load",createTab),e.open("POST","http://localhost:1029"),e.send(JSON.stringify({}))}function createTab(){var e=JSON.parse(this.response);console.log(e),createTableAll(shopTab,e)}function createTableAll(e,t){for(var n=e.children.length,a=0;a<n-1;a++)e.lastElementChild.remove();console.log(e.children.length);for(var r=0;r<t.length;r++){var o=document.createElement("tr");for(var d in t[r]){var i=document.createElement("td");if("select"===d){var l=document.createElement("input");l.type="checkbox",l.checked=t[r][d],i.appendChild(l)}else if("img"===d){var s=document.createElement("img"),c=document.createElement("span");s.src="../"+t[r].img,c.textContent=t[r].title,i.appendChild(s),i.appendChild(c)}else{if("title"===d)continue;if("idNum"===d){var p=document.createElement("span");p.textContent=t[r].idNum,i.appendChild(p)}else if("price"===d){var h=document.createElement("span");h.textContent=t[r].price,i.appendChild(h)}else if("num"===d)i.appendChild(addToShop(t[r]));else if("sum"===d){var u=document.createElement("span");u.textContent=t[r].price*t[r].num,i.appendChild(u)}else if("del"===d){var m=document.createElement("button");m.textContent="删除",m.bool=t[r].del,m.onclick=function(e){((e=e||window.event).target||e.srcElement).parentNode.parentNode.remove()},i.appendChild(m)}}o.appendChild(i)}e.appendChild(o)}}function addToShop(e){console.log(e);var t=document.createElement("div");t.className="shopBox",t.data=e;var n=document.createElement("button"),a=document.createElement("input"),r=document.createElement("button");return a.value=e.num,n.addEventListener("click",sendData),a.addEventListener("blur",sendData),r.addEventListener("click",sendData),n.textContent="-",r.textContent="+",t.appendChild(n),t.appendChild(a),t.appendChild(r),t}function sendData(e){if("+"===this.textContent)this.parentNode.data.num++,99<this.parentNode.data.num&&(this.parentNode.data.num=99);else if("-"===this.textContent)this.parentNode.data.num--,this.parentNode.data.num<1&&(this.parentNode.data.num=1);else{if(isNaN(this.value))return void(this.value=1);this.parentNode.data.num=this.value,this.value<1?this.parentNode.data.num=1:99<this.value&&(this.parentNode.data.num=99)}this.parentNode.data.sum=this.parentNode.data.num*this.parentNode.data.price,sendedData(this.parentNode.data)}function sendedData(e){var t=new XMLHttpRequest;t.self=this,t.addEventListener("load",sendAllData),t.open("POST","http://localhost:1028"),t.send(JSON.stringify(e))}function sendAllData(e){console.log(JSON.parse(this.response)),getData()}xhr.addEventListener("load",loadHandler),xhr.open("get","../json/city.json"),xhr.send(),getData();