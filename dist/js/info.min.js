var jsonList,sameList=[],isItem={},xhr=new XMLHttpRequest;xhr.addEventListener("load",loadShopList),xhr.open("get","../json/shopList.json"),xhr.send();var arr,xhr1=new XMLHttpRequest,areaContent={area:""};function loadHandler(e){arr=JSON.parse(this.response),loadArea(areaContent),areaBox.addEventListener("mouseenter",findP),place.addEventListener("mouseleave",clearAll)}function findP(e){place.style.display="block";for(var t=place.children.length,n=0;n<t;n++)place.firstElementChild.remove();for(var i=0;i<arr.length;i++){var a=document.createElement("div");a.textContent=arr[i].name,a.data=arr[i],a.addEventListener("click",findCity),place.appendChild(a)}}function findCity(e){for(var t=place.children.length,n=0;n<t;n++)place.firstElementChild.remove();for(var i=this.data.city,a=0;a<i.length;a++){var d=document.createElement("div");d.textContent=i[a].name,d.data=i[a],d.father=this,d.addEventListener("click",findArea),place.appendChild(d)}}function findArea(e){for(var t=place.children.length,n=0;n<t;n++)place.firstElementChild.remove();for(var i=this.data.area,a=0;a<i.length;a++){var d=document.createElement("div");d.textContent=i[a],d.father=this,d.addEventListener("click",addAddress),place.appendChild(d)}}function addAddress(e){areaContent.area=this.father.father.textContent+","+this.father.textContent+","+this.textContent,loadArea(areaContent);for(var t=place.children.length,n=0;n<t;n++)place.firstElementChild.remove()}function clearAll(e){place.style.display="none"}function loadArea(e){var t=new XMLHttpRequest;t.addEventListener("load",startArea),t.open("POST","http://localhost:1027"),t.send(JSON.stringify(e))}function startArea(e){areaBox.textContent=this.response}function loadShopList(e){findItem(jsonList=JSON.parse(this.response)),typeList(jsonList),createTree(listTree,isItem),createPicList(piclist,isItem.list.img),createItem(everyInfo,isItem.list),createSame(sameThing.firstElementChild,sameList);var t={select:!1};for(var n in isItem.list)t[n]="price"===n?Number(isItem.list.price.split("¥")[1]):isItem.list[n];t.num=1,t.sum=t.num*t.price,t.del=!1;var i=document.createElement("div");i.id="shopBox",everyInfo.lastElementChild.appendChild(i),addToShop(i,t)}function findItem(e){for(var t=location.href.split("?")[1],n=0;n<e.length;n++)if(0===n||9===n){for(var i=0;i<e[n].length;i++)if(e[n][i].href===t)return isItem.first="热门商品",isItem.second="商品",isItem.third=e[n][i].title,isItem.list=e[n][i],void(sameList=e[n])}else for(var a=3;a<e[n].length;a++)if(e[n][a].href===t)return isItem.first=e[n][0].title,isItem.second=e[n][1].title1,isItem.third=e[n][a].title,isItem.list=e[n][a],void(sameList=e[n])}function typeList(e){for(var t=document.createElement("ul"),n=document.createElement("div"),i=2;i<e.length-1;i++){var a=document.createElement("li"),d=document.createElement("a");d.href="oneType.html?"+i,d.textContent=e[i][0].title,a.list=e[i],a.div=n,a.addEventListener("mouseover",screenList),a.appendChild(d),t.appendChild(a)}t.div=n,t.addEventListener("mouseleave",hideList),t.appendChild(n),allType.appendChild(t)}function screenList(e){for(var t=this.div.children.length,n=0;n<t;n++)this.div.firstElementChild.remove();this.div.style.display="block";var i=document.createElement("div"),a=document.createElement("h3");a.textContent=this.textContent;var d=document.createElement("ul");for(var l in this.list[1]){var s=document.createElement("li");s.textContent=this.list[1][l],d.appendChild(s)}var r=document.createElement("div"),o=document.createElement("h2");o.textContent="相关热门",r.appendChild(o);for(var h=3;h<this.list.length-1;h++){var p=document.createElement("a");for(var c in p.href="info.html?"+this.list[h].href,this.list[h])if("img"===c){var m=new Image;m.src="../"+this.list[h][c],p.appendChild(m)}else if("title"===c){var f=document.createElement("p");f.textContent=this.list[h][c],p.appendChild(f)}else if("price"===c){var v=document.createElement("span");v.textContent="售价"+this.list[h][c],p.appendChild(v)}r.appendChild(p)}i.appendChild(a),i.appendChild(d),this.div.appendChild(i),this.div.appendChild(r)}function hideList(e){this.div.style.display="none"}function createTree(e,t){var n=document.createElement("li");for(var i in n.textContent="全部分类",e.appendChild(n),t)if("list"!==i){var a=document.createElement("li");a.textContent=">"+t[i],e.appendChild(a)}}function createPicList(e,t){var n=document.createElement("li"),i=new Image;i.src="../"+t,n.appendChild(i),e.appendChild(n)}function createItem(e,t){for(var n=e.children.length,i=0;i<n.length;i++)e.firstElementChild.remove();var a=document.createElement("div");for(var d in t)if("img"===d){var l=document.createElement("div"),s=document.createElement("span"),r=document.createElement("span"),o=new Image,h=new Image,p=document.createElement("span");h.className="bigimg",p.className="bigbox",o.className="smallimg",r.className="block",s.className="mark",o.src="../"+t[d],h.src="../"+t[d],s.addEventListener("mouseover",bigHandler),s.addEventListener("mouseout",bigHandler),p.appendChild(h),l.appendChild(o),l.appendChild(s),l.appendChild(p),l.appendChild(r),e.appendChild(l)}else if("title"===d){var c=document.createElement("h2");c.textContent=t[d],a.appendChild(c)}else if("href"===d){var m=document.createElement("span");m.textContent="商品货号: "+t[d],a.appendChild(m)}var f=document.createElement("div"),v=document.createElement("span"),u=document.createElement("span");v.textContent="风尚价: ",u.textContent=t.price,f.appendChild(v),f.appendChild(u),a.appendChild(f),a.innerHTML+="<span class='area'>送至:</span><div id='areaBox'></div><div id='place'></div>",e.appendChild(a)}function bigHandler(e){"mouseover"===e.type?(this.parentNode.lastElementChild.style.display="block",this.parentNode.children[2].style.display="block",this.addEventListener("mousemove",moveHandler)):(this.parentNode.lastElementChild.style.display="none",this.parentNode.children[2].style.display="none")}function moveHandler(e){var t=e.pageX-this.parentNode.offsetLeft-this.offsetLeft-this.parentNode.lastElementChild.offsetWidth/2,n=e.pageY-this.parentNode.offsetTop-this.offsetTop-this.parentNode.lastElementChild.offsetHeight/2;t<=0?t=0:t>=this.offsetWidth-this.parentNode.lastElementChild.offsetWidth&&(t=this.offsetWidth-this.parentNode.lastElementChild.offsetWidth),n<=0?n=0:n>=this.offsetHeight-this.parentNode.lastElementChild.offsetHeight&&(n=this.offsetHeight-this.parentNode.lastElementChild.offsetHeight),this.parentNode.lastElementChild.style.left=t+"px",this.parentNode.lastElementChild.style.top=n+"px",this.parentNode.children[2].firstElementChild.style.left=2*-t+"px",this.parentNode.children[2].firstElementChild.style.top=2*-n+"px"}function createSame(e,t){for(var n=3;n<t.length;n++){var i=document.createElement("a");i.href="../html/info.html?"+t[n].href;var a=document.createElement("li"),d=new Image;d.src="../"+t[n].img;var l=document.createElement("span");l.textContent=t[n].title;var s=document.createElement("div");s.textContent=t[n].price,i.appendChild(d),i.appendChild(l),i.appendChild(s),a.appendChild(i),e.appendChild(a)}}xhr1.addEventListener("load",loadHandler),xhr1.open("get","../json/city.json"),xhr1.send();var obj={};function logined(e){var t=new XMLHttpRequest;t.addEventListener("load",userLogin),t.open("POST","http://localhost:1026"),t.send(JSON.stringify(e))}function userLogin(e){var t=JSON.parse(this.response);t.isLogin?(loginTo.textContent=t.userObj,loginTo.href="",regTo.textContent="退出",regTo.href="",regTo.addEventListener("click",exitLogin)):(loginTo.textContent="登录",loginTo.href="html/login.html",regTo.removeEventListener("click",exitLogin),regTo.textContent="注册",regTo.href="html/regist.html")}function exitLogin(e){obj.exit=!0;var t=new XMLHttpRequest;t.addEventListener("load",userLogin),t.open("POST","http://localhost:1026"),t.send(JSON.stringify(obj))}function addToShop(e,t){for(var n=e.children.length,i=0;i<n;i++)e.firstElementChild.remove();e.nextElementSibling&&e.nextElementSibling.remove(),e.data=t;var a=document.createElement("button"),d=document.createElement("input"),l=document.createElement("button");d.value=t.num,a.addEventListener("click",sendData),d.addEventListener("blur",sendData),l.addEventListener("click",sendData),a.textContent="-",l.textContent="+",e.appendChild(a),e.appendChild(d),e.appendChild(l);var s=document.createElement("div");s.list=t,s.addEventListener("click",startData),s.textContent="加入购物车",everyInfo.lastElementChild.appendChild(s)}function startData(e){var t=this.list;sendedData.apply(this,t)}function sendData(e){if("+"===this.textContent)this.parentNode.data.num++,99<this.parentNode.data.num&&(this.parentNode.data.num=99);else if("-"===this.textContent)this.parentNode.data.num--,this.parentNode.data.num<1&&(this.parentNode.data.num=1);else{if(isNaN(this.value))return void(this.value=1);this.parentNode.data.num=this.value,this.value<1?this.parentNode.data.num=1:99<this.value&&(this.parentNode.data.num=99)}this.parentNode.data.sum=this.parentNode.data.num*this.parentNode.data.price,sendedData(this.parentNode.data)}function sendedData(e){var t=new XMLHttpRequest;t.addEventListener("load",sendAllData),t.open("POST","http://localhost:1028"),(t.self=this)instanceof HTMLDivElement?(console.log(this.list),t.send(JSON.stringify(this.list))):t.send(JSON.stringify(e))}function sendAllData(e){addToShop(shopBox,JSON.parse(this.response)),"加入购物车"===this.self.textContent&&(location.href="shopping.html")}logined(obj);