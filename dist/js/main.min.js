var allShopList,itemList,Carousel=function(){var l={width:"10px",height:"10px",borderRadius:"20px",backgroundColor:"#C9CED2",float:"left",lineHeight:"20px",textAlign:"center",marginLeft:"20px",color:"white"},a={margin:0,padding:0,listStyle:"none",position:"absolute",bottom:"20px"},r={position:"absolute",left:"0px"},h={overflow:"hidden",position:"relative",margin:"auto",backgroundColor:"antiquewhite"};function t(t,e,i){this.initCarousel(t,i),this.source=e}return(t.prototype={carouselView:null,imageList:[],_width:0,_height:0,_source:[],position:0,direction:"",bool:!1,autoBool:!1,speed:100,preDot:null,time:200,set source(t){t&&Array.isArray(t)&&0!==t.length&&(this.width=0,(this.height=0)<this.imageList.length&&this.imageList[this.imageList.length-1].removeEventListener("load",this.loadImageHandler),this.imageList.length=0,this._source=t,this.reloadImg(t))},get source(){return this._source},set width(t){if(this._width=t,0!==this.imageList.length){this.carouselView.style.width=t+"px";var e=this.carouselView.lastElementChild;e.style.left=(t-e.offsetWidth)/2+"px"}},get width(){return this._width},set height(t){this._height=t,0!==this.imageList.length&&(this.carouselView.style.height=t+"px",this.carouselView.firstElementChild.style.height=t+"px",this.carouselView.children[1].style.top=this.carouselView.children[2].style.top=(this.height-this.carouselView.children[1].offsetHeight)/2+"px")},get height(){return this._height},reloadImg:function(t){var e=new Image;e.addEventListener("load",this.loadImageHandler),e.list=t,e.self=this,e.num=0,e.imgList=[],e.src=t[e.num]},loadImageHandler:function(t){this.imgList.push(this.cloneNode(!1)),this.num++,this.num>this.list.length-1?this.self.imgLoadFinish(this.imgList):this.src=this.list[this.num]},imgLoadFinish:function(t){this.imageList=t;var e=this.carouselView.firstElementChild,i=this.carouselView.lastElementChild;this.clearCon(e),this.clearCon(i),e.appendChild(this.imageList[0]);for(var n=0;n<this.imageList.length;n++){var s=document.createElement("li");Object.assign(s.style,l),i.appendChild(s)}0===this.width?this.width=this.imageList[0].width:(this.carouselView.style.width=this.width+"px",this.setWidth(e,this.width)),0===this.height?this.height=this.imageList[0].height:(this.carouselView.style.height=this.height+"px",this.carouselView.firstElementChild.style.height=this.height+"px",this.setWidth(e,0,this.height)),this.changeDot(),i.style.left=(this.width-i.offsetWidth)/2+"px"},setWidth:function(t,e,i){for(var n=0;n<t.children.length;n++)e&&(t.children[n].style.width=e+"px"),i&&(t.children[n].style.height=i+"px")},clearCon:function(t){for(var e=t.children.length,i=0;i<e;i++)t.firstElementChild.remove()},initCarousel:function(t,e){if(!this.carouselView){this.carouselView=document.createElement("div"),Object.assign(this.carouselView.style,h),(this.carouselView.self=this).carouselView.addEventListener("mouseenter",this.mouseCarouselHandler),this.carouselView.addEventListener("mouseleave",this.mouseCarouselHandler);var i=document.createElement("div");this.carouselView.appendChild(i),Object.assign(i.style,r);for(var n=0;n<e.length;n++){var s=new Image;s.self=this,s.addEventListener("load",this.bnLoadHandler),s.src=e[n];var l={height:0,position:"absolute"};0===n?l.left="10px":l.right="10px",Object.assign(s.style,l),s.addEventListener("click",this.bnClickHandler),this.carouselView.appendChild(s)}var o=document.createElement("ul");Object.assign(o.style,a),this.carouselView.appendChild(o),o.self=this,o.addEventListener("click",this.dotClickHandler),t.appendChild(this.carouselView)}return this.carouselView},bnLoadHandler:function(t){this.style.top=(this.self.height-this.offsetHeight)/2+"px"},bnClickHandler:function(t){this.self.bool||(10===this.offsetLeft?(this.self.direction="right",this.self.position--,this.self.position<0&&(this.self.position=this.self.imageList.length-1)):(this.self.direction="left",this.self.position++,this.self.position>this.self.imageList.length-1&&(this.self.position=0)),this.self.createNextImg())},dotClickHandler:function(t){if(!(this.self.bool||t.target instanceof HTMLUListElement)){var e=Array.from(this.children).indexOf(t.target);e!==this.self.position&&(e>this.self.position?this.self.direction="left":this.self.direction="right",this.self.position=e,this.self.createNextImg())}},createNextImg:function(){if("left"===this.direction||"right"===this.direction){var t=this.carouselView.firstElementChild;"left"===this.direction?(t.appendChild(this.imageList[this.position]),t.style.width=2*this.width+"px",t.style.left="0px"):(t.insertBefore(this.imageList[this.position],t.firstElementChild),t.style.width=2*this.width+"px",t.style.left=-this.width+"px"),0!==this.width&&(this.imageList[this.position].style.width=this.width+"px"),0!==this.height&&(this.imageList[this.position].style.height=this.height+"px"),this.changeDot(),this.bool=!0}},update:function(){this.autoPlay(),this.imgCarousel()},autoPlay:function(){this.autoBool&&(this.time--,0<this.time||(this.time=200,this.direction="left",this.position++,this.position>this.imageList.length-1&&(this.position=0),this.createNextImg()))},imgCarousel:function(){if(this.bool)if("left"===this.direction||"right"===this.direction){var t=this.carouselView.firstElementChild;"left"===this.direction?(t.style.left=t.offsetLeft-this.speed+"px",t.offsetLeft<=-this.width&&(t.firstElementChild.remove(),t.style.left="0px",this.bool=!1,this.direction="")):(t.style.left=t.offsetLeft+this.speed+"px",0<=t.offsetLeft&&(t.style.left="0px",t.lastElementChild.remove(),this.bool=!1,this.direction=""))}else this.bool=!1},changeDot:function(){this.preDot&&(this.preDot.style.backgroundColor="#C9CED2"),this.preDot=this.carouselView.lastElementChild.children[this.position],this.preDot.style.backgroundColor="#FA6500"},mouseCarouselHandler:function(t){"mouseenter"===t.type?this.self.autoBool=!1:"mouseleave"===t.type&&(this.self.autoBool=!0)}}).constructor=t}(),xhr1=new XMLHttpRequest;function loadShopList(t){allShopList=JSON.parse(this.response);var e=document.getElementById("hot_list");creatHotLi(allShopList[0],e),creatShopListAll(shop_list1,allShopList[1]),creatShopListAll(shop_list2,allShopList[2]),creatShopListAll(shop_list3,allShopList[3]),creatShopListAll(shop_list4,allShopList[4]),creatShopListAll(shop_list5,allShopList[5]),creatShopListAll(shop_list6,allShopList[6]),creatShopListAll(shop_list7,allShopList[7]),creatShopListAll(shop_list8,allShopList[8]),itemList=allShopList[9],init(),typeList(allShopList)}xhr1.addEventListener("load",loadShopList),xhr1.open("get","json/shopList.json"),xhr1.send();var arr=["img/main/banner1.jpg","img/main/banner2.jpg","img/main/banner3.jpg","img/main/banner4.jpg","img/main/banner5.jpg","img/main/banner6.jpg","img/main/banner7.jpg"];arr1=["img/main/jiantou.png"];var box,pic_box,left,right,dot_box,liList,carousel=new Carousel(banner,arr,arr1);function animate(){requestAnimationFrame(animate),carousel.update()}carousel.width=banner.offsetWidth,carousel.height=420,animate();var direct,count=0,num=160,bool=!1,autoPlay=!0,picurl=["img/main/banner_shop1.jpg","img/main/banner_shop2.jpg","img/main/banner_shop3.jpg","img/main/banner_shop4.jpg"],piclist=[],imgList=[],WIDTH=360,HEIGHT=404;function init(){box=document.getElementById("shopScroll"),pic_box=document.getElementById("shopScroll_pic"),dot_box=document.getElementById("shopScroll_dot"),box.addEventListener("mouseenter",isAuto),box.addEventListener("mouseleave",isAuto),creatImg(),animation(),creatDot()}function creatImg(){for(var t=0;t<picurl.length;t++)for(var e in piclist[t]=document.createElement("a"),piclist[t].href="html/info.html?"+itemList[t].href,piclist[t].style.display="inline-block",imgList[t]=new Image,imgList[t].src=picurl[t],piclist[t].appendChild(imgList[t]),piclist[t].style.width=WIDTH+"px",piclist[t].style.height=HEIGHT+"px",itemList[t])if("href"!==e){var i=document.createElement("div");i.textContent=itemList[t][e],piclist[t].appendChild(i)}pic_box.appendChild(piclist[0])}function nextPic(){pic_box.style.width=2*WIDTH+"px","right"===direct?(pic_box.appendChild(piclist[count]),pic_box.style.left=0):"left"===direct&&(pic_box.insertBefore(piclist[count],pic_box.firstElementChild),pic_box.style.left=-WIDTH+"px"),bool=!0,liChange()}function animation(){requestAnimationFrame(animation),picMove(),autoScroll()}function creatDot(){for(var t=0;t<picurl.length;t++){var e=document.createElement("li");dot_box.appendChild(e),e.style.background="#CCCCCC"}dot_box.firstElementChild.style.background="#FD823E",dot_box.addEventListener("click",changeDot),liChange()}function changeDot(t){if(!bool){var e=Array.from(dot_box.children).indexOf(t.target);e!==count&&(count<e?direct="right":e<count&&(direct="left"),count=e,nextPic())}}function liChange(){liList&&(liList.style.backgroundColor="#CCCCCC"),(liList=dot_box.children[count]).style.background="#FD823E"}function picMove(){bool&&("left"===direct?(pic_box.style.left=pic_box.offsetLeft+10+"px",0<pic_box.offsetLeft&&(bool=!1,pic_box.lastElementChild.remove())):"right"===direct&&(pic_box.style.left=pic_box.offsetLeft-10+"px",pic_box.offsetLeft<-WIDTH&&(bool=!1,pic_box.firstElementChild.remove(),pic_box.style.left=0)))}function autoScroll(){autoPlay&&0===--num&&(num=160,direct="right",++count===picurl.length&&(count=0),nextPic())}function isAuto(t){"mouseenter"===t.type?autoPlay=!1:(t.type="mouseleave")&&(autoPlay=!0)}function creatHotLi(t,e){for(var i=0;i<t.length;i++){var n=document.createElement("li"),s=document.createElement("a");for(var l in s.href="html/info.html?"+t[i].href,s.style.display="block",t[i])if("img"===l){var o=new Image;o.src=t[i][l],s.appendChild(o)}else if("title"===l||"price"===l){var a=document.createElement("div");a.textContent=t[i][l],s.appendChild(a)}n.appendChild(s),e.appendChild(n)}}function creatShopListAll(t,e){for(var i=t.children.length,n=0;n<i;n++)t.firstElementChild.remove();var s=document.createElement("div"),l=document.createElement("h2");for(var o in l.textContent=e[0].title,s.appendChild(l),t.appendChild(s),e[1])if(e[1][o]){var a=document.createElement("span");a.textContent=e[1][o],l.appendChild(a)}for(n=2;n<e.length;n++){var r=document.createElement("li"),h=document.createElement("a");for(var d in h.href="html/info.html?"+e[n].href,h.style.display="block",e[n])if("img"===d){var c=new Image;c.src=e[n][d],h.appendChild(c)}else if("title"===d||"price"===d){var p=document.createElement("div");p.textContent=e[n][d],h.appendChild(p)}r.appendChild(h),t.appendChild(r)}}function typeList(t){for(var e=document.createElement("ul"),i=document.createElement("div"),n=2;n<t.length-1;n++){var s=document.createElement("li"),l=document.createElement("a");l.href="html/oneType.html?"+n,l.textContent=t[n][0].title,s.list=t[n],s.div=i,s.addEventListener("mouseover",screenList),s.appendChild(l),e.appendChild(s)}e.div=i,e.addEventListener("mouseleave",hideList),e.appendChild(i),allType.appendChild(e)}function screenList(t){for(var e=this.div.children.length,i=0;i<e;i++)this.div.firstElementChild.remove();this.div.style.display="block";var n=document.createElement("div"),s=document.createElement("h3");s.textContent=this.textContent;var l=document.createElement("ul");for(var o in this.list[1]){var a=document.createElement("li");a.textContent=this.list[1][o],l.appendChild(a)}var r=document.createElement("div"),h=document.createElement("h2");h.textContent="相关热门",r.appendChild(h);for(var d=3;d<this.list.length-1;d++){var c=document.createElement("a");for(var p in c.href="html/info.html?"+this.list[d].href,this.list[d])if("img"===p){var m=new Image;m.src=this.list[d][p],c.appendChild(m)}else if("title"===p){var f=document.createElement("p");f.textContent=this.list[d][p],c.appendChild(f)}else if("price"===p){var u=document.createElement("span");u.textContent="售价"+this.list[d][p],c.appendChild(u)}r.appendChild(c)}n.appendChild(s),n.appendChild(l),this.div.appendChild(n),this.div.appendChild(r)}function hideList(t){this.div.style.display="none"}function logined(t){var e=new XMLHttpRequest;e.addEventListener("load",userLogin),e.open("POST","http://localhost:1026"),e.send(JSON.stringify(t))}function userLogin(t){var e=JSON.parse(this.response);e.isLogin?(loginTo.textContent=e.userObj,loginTo.href="",regTo.textContent="退出",regTo.href="",regTo.addEventListener("click",exitLogin)):(loginTo.textContent="登录",loginTo.href="html/login.html",regTo.removeEventListener("click",exitLogin),regTo.textContent="注册",regTo.href="html/regist.html")}function exitLogin(t){obj.exit=!0;var e=new XMLHttpRequest;e.addEventListener("load",userLogin),e.open("POST","http://localhost:1026"),e.send(JSON.stringify(obj))}obj={},logined(obj);var xhr=new XMLHttpRequest,areaContent={area:""};function loadHandler(t){arr=JSON.parse(this.response),areaBox.addEventListener("mouseenter",findP),place.addEventListener("mouseleave",clearAll),loadArea(areaContent)}function findP(t){place.style.display="block";for(var e=place.children.length,i=0;i<e;i++)place.firstElementChild.remove();for(var n=0;n<arr.length;n++){var s=document.createElement("div");s.textContent=arr[n].name,s.data=arr[n],s.addEventListener("click",findCity),place.appendChild(s)}}function findCity(t){for(var e=place.children.length,i=0;i<e;i++)place.firstElementChild.remove();for(var n=this.data.city,s=0;s<n.length;s++){var l=document.createElement("div");l.textContent=n[s].name,l.data=n[s],l.father=this,l.addEventListener("click",findArea),place.appendChild(l)}}function findArea(t){for(var e=place.children.length,i=0;i<e;i++)place.firstElementChild.remove();for(var n=this.data.area,s=0;s<n.length;s++){var l=document.createElement("div");l.textContent=n[s],l.father=this,l.addEventListener("click",addAddress),place.appendChild(l)}}function addAddress(t){areaContent.area=this.father.father.textContent+","+this.father.textContent+","+this.textContent,loadArea(areaContent);for(var e=place.children.length,i=0;i<e;i++)place.firstElementChild.remove()}function clearAll(t){place.style.display="none"}function loadArea(t){var e=new XMLHttpRequest;e.addEventListener("load",startArea),e.open("POST","http://localhost:1027"),e.send(JSON.stringify(t))}function startArea(t){console.log(this.response),areaBox.textContent=this.response}xhr.addEventListener("load",loadHandler),xhr.open("get","json/city.json"),xhr.send();